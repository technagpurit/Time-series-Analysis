# -*- coding: utf-8 -*-
"""Untitled17.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1Ih9Q3PXWfs4ub8vbvrFegRaEUD64nphr
"""

import numpy as np
from scipy.signal import argrelextrema
from scipy.interpolate import CubicSpline

def resid(t,f):
  maxm = argrelextrema(f, np.greater)
  minm = argrelextrema(f, np.less)
  maxCS = CubicSpline(t[maxm], f[maxm])
  maxi = maxCS(t, extrapolate=None)
  minCS = CubicSpline(t[minm], f[minm])
  mini = minCS(t, extrapolate=None)
  meani = (maxi + mini) / 2.0
  return f - meani

def IMF(t, f, Nmax=200, SDmax=0.01, Zmax=5):
  ftmp = f
  i = 0
  Zok = 0
  while i<Nmax:
    r1 = resid(t, ftmp)
    SD = np.sum(np.power(np.abs(ftmp - r1), 2) / np.power(ftmp, 2))
    maxm = argrelextrema(r1, np.greater)
    minm = argrelextrema(r1, np.less)
    Nzero = ((r1[:-1] * r1[1:]) < 0).sum()
    if np.abs(Nzero - (np.size(maxm)+np.size(minm))) < 2:
      Zok = Zok + 1
    if SD <= SDmax:
      i=Nmax
    if Zok >= Zmax:
      i=Nmax
    i=i+1
    ftmp = r1
  return r1

import matplotlib.pyplot as plt

from pandas import read_csv
TS=read_csv('newdataset.csv',index_col=0)

TS.shape

data = TS.values
plt.plot(data)
plt.show()

IMF(data[0], data, Nmax=200, SDmax=0.01, Zmax=5)
